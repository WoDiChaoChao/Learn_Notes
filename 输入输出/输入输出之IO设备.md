# 操作系统之IO设备

I/O设备又叫做输入/输出设备

输入/输出设备能够向计算机发送数据（输出）并从计算机接收数据（输入）

I/O设备可以分为两种：

​	块设备（一块一块地发送）

​	字符设备（一个字符一个字符地发送）

## 块设备

块设备是一个能存储固定大小块信息的设备，支持以固定大小的块，扇区或集群读取和写入

每个块都有自己的物理地址，（512-65536）

常见的块设备有 硬盘，光盘，USB盘

缺点：

​	基于给定固态存储器的块设备比基于相同类型的存储器的字节寻址要慢一些，因为必须在块的开头开始读取或写入

## 字符设备

字符设备以字符为单位发送或接收一个字符流，而不考虑任何块结构

字符设备是不可寻址的，也没有任何寻道操作

常见的字符设备有 打印机 网络设备 鼠标 以及大多数与磁盘不同的设备

## 设备控制器

设备控制器是处理CPU传入和传出信号的系统

根据块设备和字符设备分为块设备控制器，字符设备控制器

设备通过插头和插座连接到计算机，并且插座连接到设备控制器，设备控制器通过接收CPU信号从连接的设备处接收和发送数据，并存储在控制器内部的一些特殊目的寄存器

<img src="..\images\image-20240308093904370.png" alt="image-20240308093904370" style="zoom:60%;" />

每个设备控制器都会有一个应用程序与之对应，设备控制器通过应用程序的接口来与操作系统进行通信

I/O设备通常由机械组件（设备本身）和电子组件（进行通信）构成，比如U盘中的插头部分是电子组件，内部是机械组件

<img src="..\images\image-20240308094751174.png" alt="image-20240308094751174" style="zoom:67%;" />

控制器还会将二进制进行译码，将二进制流传输给设备，进而还有数据检验

# 端口和内存映射I/O

每个控制器都会有几个寄存器用来和CPU进行通信

为了控制寄存器，许多设备都会有数据缓冲区，来供系统进行读写

CPU如何与设备寄存器和设备数据缓冲区进行通信呢？

## 端口映射I/O

每个控制寄存器都被分配一个I/O端口号，这是一个8位或16位的整数

<img src="..\images\image-20240308154821364.png" alt="image-20240308154821364" style="zoom:67%;" />

内存和I/O端口是两个不同的地址空间，在逻辑上设计的是相互隔离，在物理上也是隔离的，这时就增加了一条专门的总线，叫做I/O总线，**I/O端口只有操作系统可以访问**

## 内存映射I/O

所有控制寄存器映射到内存空间，映射要集中映射到一起，使用相同的总线处理内存和I/O设备控制器

<img src="..\images\image-20240308155409615.png" alt="image-20240308155409615" style="zoom:50%;" />

这时对于I/O设备而言，对于CPU发来的指令，要时刻监督是否给自己发的

 

大型机利用的是端口映射I/O，因为安全，**I/O端口只有操作系统可以访问**

个人计算机利用的是内存映射I/O，因为用户对自己的电脑操作权限还是很高的

# 直接内存访问

<img src="..\images\image-20240308193512294.png" alt="image-20240308193512294" style="zoom:50%;" />

在这种总线型结构中，数据如果以字节传输，cpu会不断地做中断，中断其他任务，去接收总线的字节，接收一个字节，再中断去继续之前的任务；数据如果以块进行传输，会导致CPU一直被占用。

为了解决以上浪费CPU的情况----->直接内存访问



以单一的数据总线为例：

<img src="..\images\image-20240308193904616.png" alt="image-20240308193904616" style="zoom:50%;" />

使用DMA可以解放CPU去干其他的事情
# 操作系统之文件系统

磁盘/固态硬盘

磁盘支持的操作

​	读块/写块

​	解决了长期存储的问题

磁盘还有一些不便于实现的操作

​	如何找到这些信息

​	如何保证一个用户不会读取另外一个用户的数据

​	怎么知道哪些块是空闲的等等

针对这些问题提出了一个新的抽象----文件

## 文件

文件是由进程创建的逻辑信息单元

一个磁盘会包含几千甚至几百万个文件，每个文件是独立于其他文件的

文件不会因为进程的创建和终止而受影响。一个文件只能在有明确删除的时候才能消失

所有文件由操作系统进行管理，有关文件的构造，命名，访问，使用，保护，实现和管理方式都是操作系统设计的主要内容----------文件系统

## 文件系统----文件

* 文件命名

  文件是一种抽象机制，它提供了一种方式用来存储信息以及在后面进行读取

  Windows引入MS-DOS（不区分大小写），称之为FAT-16，后来扩展为FAT-32

  目前新的操作系统支持另外一个新的文件系统，NTFS（本机文件系统），NTFS有更大的分区，更安全，更可以有效的管理，日志式的存储

  Windows8服务器版本-----ReFS

  MAC-----exFAT

  <img src="..\images\image-20240301174743240.png" alt="image-20240301174743240" style="zoom:67%;" />

  Linux/Unix对文件后缀名是不强求的，谁用谁来管理，Windows对后缀名是强制的

* 文件结构

  <img src="..\images\image-20240301175413220.png" alt="image-20240301175413220" style="zoom:50%;" />

  字节序列

  ​	没有任何结构，就按一个个字节来，操作系统只能看到一个个的字节，目前Windows和Linux都采用这种结构，操作非常灵活，可以写入任何内容，以任何方式来命名

  

  记录序列

  ​	文件是由固定大小记录的序列



​		树

* 文件类型

  很多操作系统支持多种文件类型。例如，UNIX和Windows都具有常规的文件和目录

  UNIX具有字符特殊文件和块特殊文件

  常规文件：用户使用的文件，文本文档，图片，可执行文件等等，由文件系统驱动程序处理

  字符特殊文件：字符设备---->管道，端口

  快特殊文件：块设备--->磁盘上的一个分区

  驱动程序来处理字符特殊文件和快特殊文件，对这些文件的处理更加及时，比如鼠标键盘这种设备的输入输出

  常规文件一般分为ASCLL码文件（文本组成，每一行用回车结束，优点在于便于显示和打印）或者二进制文件（人无法理解）

  分层文件系统------目录

  <img src="..\images\image-20240301181508177.png" alt="image-20240301181508177" style="zoom:50%;" />

  ​															二进制文件的两种形式

  

  魔数：用来真正区分不同的文件，魔数是固定的

* 文件访问

  早期的操作系统只有一种访问方式：序列访问，访问完了可以回到起点 read

  随机访问文件：在使用磁盘来存储文件时，可以不按照顺序读取文件中的字节或者记录，按照关键字而不是位置来访问记录  seek

* 文件属性

  文件包括文件名和数据。除此之外，所有的操作系统还会保存其他与文件相关的信息，如文件创建的日期和时间，文件的大小---------文件属性/元数据

<img src="..\images\image-20240301183511866.png" alt="image-20240301183511866" style="zoom:67%;" />

* 文件操作

  创建，删除，打开，关闭，读取，添加等等，每个操作都有对应的系统调用

# 目录

## 一级目录系统

最简单的形式，早期计算机使用，只有一个包含所有文件的目录，这种目录被称为根目录

<img src="..\images\image-20240302105357348.png" alt="image-20240302105357348" style="zoom:50%;" />

优点：结构简单，便于定位，应用于某些嵌入式设备中

## 层次目录系统

<img src="..\images\image-20240302105536086.png" alt="image-20240302105536086" style="zoom:50%;" />

## 路径名

当目录树组织文件系统时，需要有某种方法指明文件名

常用的方法有两种

​	绝对路径

​	相对路径

支持层次目录结构的操作系统还有两个特殊的目录项   .(当前目录)     ..(父目录)

## 目录操作

创建，删除，打开，关闭，读取，添加等等，每个操作都有对应的系统调用
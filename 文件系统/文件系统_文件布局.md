# 文件系统的实现

## 文件系统的布局

文件系统存储在磁盘中。大部分磁盘能够划分出一到多个分区，叫做磁盘分区或者磁盘分片

磁盘的0号分区称为主引导记录（MBR），用来引导计算机

在MBR的结尾是分区表

MBR可以用在DOS，Windows和linux操作系统中，从2010年代中期开始，大多数新计算机都改用GUID分区表（GPT）分区方案，GPT相较于MBR分区更多，性能更高

<img src="..\images\image-20240302113216181.png" alt="image-20240302113216181" style="zoom:50%;" />

### 引导块

MBR做的第一件事就是确定活动分区，读入它的第一个块并执行，称为引导块，引导块中的程序会加载分区中的操作系统，占据4096个字节，引导的整个过程是计算机的启动过程，开机之后向内存中装入命令也是引导块在做



**计算机的启动过程**：从主板开始，有一个BIOS芯片，开机后，首先BIOS检查基础设备（鼠标键盘，显示器，内存条等等）是否安装成功并且成功响应，然后扫描总线上的所有设备（外接插入设备），基础设备和外接插入设备会记录在CMOS芯片中

### 超级块

紧跟在引导块后面的是超级块，超级块的大小为4096字节，从磁盘上的字节偏移4096开始。超级块包含文件系统的所有关键参数

​	文件系统的大小

​	文件系统中的数据块数

​	指示文件系统状态的标志

​	分配组大小

### 空闲空间块

文件系统中空闲块的信息-------------可以用位图或者指针列表的形式

 位图或位向量是一系列位或位的集合，其中每个位对应一个磁盘块，该位可以采用两个值，0和1，0表示已分配该块，而1表示一个空闲块

<img src="..\images\image-20240302172156532.png" alt="image-20240302172156532" style="zoom:50%;" />



<img src="..\images\image-20240302172231756.png" alt="image-20240302172231756" style="zoom:50%;" />

### 碎片

一般零散的单个数据通常称为片段

磁盘块可以进一步分为固定大小的分配单元，片段只是在驱动器上批次不相邻的文件片段

### INODE

索引节点-----------index node

INODE存放的信息：

​	模式/权限（保护）

​	所有者ID

​	组ID

​	文件大小

​	文件的硬链接数

​	上次访问时间

​	最后修改时间

​	inode上次修改时间